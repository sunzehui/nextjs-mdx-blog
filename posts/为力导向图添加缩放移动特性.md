---
title: ä¸ºåŠ›å¯¼å‘å›¾æ·»åŠ ç¼©æ”¾ç§»åŠ¨ç‰¹æ€§
tags:
  - coding
  - JavaScript
mathjax: true
abbrlink: d8a2a4ab
date: 2022-06-08 12:33:21
---
åœ¨æ²¡æœ‰Echarts ä¹‹å‰ï¼ŒD3æ˜¯å›¾è¡¨é¡¹ç›®çš„æœ€ä½³é€‰æ‹©ï¼Œè€Œæœ‰äº†Echartsï¼Œä»¥åŠAntVä¹‹åï¼ŒD3åœ¨å›¾è¡¨é¢†åŸŸå°±æ¸æ¸çš„å¤±å»äº†ä¼˜åŠ¿ã€‚è²Œä¼¼æ²¡çœ‹è§æœ‰åŠ›å¯¼å‘å›¾çš„è½®å­å¯ç”¨ï¼Œd3å¼€æï¼



## è¿‡ç¨‹ğŸ‘‰

d3ä»“åº“ï¼š[d3/d3: Bring data to life with SVG, Canvas and HTML. (github.com)](https://github.com/d3/d3)

ä»å¤´å¼€å§‹æœªå…å¤ªæ…¢äº†ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªvueå°è£…ä¸€å±‚çš„ç»„ä»¶ï¼Œæ‰“å¼€ç¤ºä¾‹å„é¡¹å‚æ•°éƒ½æŒºç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹å°±æ˜¯ä¸èƒ½é¼ æ ‡ç¼©æ”¾ï¼Œè¿™æ ·çœ‹ä¸åˆ°çš„åœ°æ–¹å°±æ°¸è¿œçœ‹ä¸è§äº†ï¼Œè¿™ç‚¹éš¾é“ä½œè€…æ²¡æœ‰è€ƒè™‘åˆ°å—ï¼Œç–‘æƒ‘ã€‚

![image-20220608115701196](ä¸ºåŠ›å¯¼å‘å›¾æ·»åŠ ç¼©æ”¾ç§»åŠ¨ç‰¹æ€§/image-20220608115701196.png)

ä¸ºäº†æ·»åŠ è‡ªå·±çš„é€»è¾‘ï¼Œæ‰¾åˆ°ç»„ä»¶ä½ç½®`src/vue-d3-network.vue`ï¼Œ

å¼•å…¥éœ€è¦çš„å·¥å…·åŒ…ğŸ“¦

```javascript
// é€‰ä¸­svgæ ‡ç­¾ç”¨
import { select } from "d3-selection";
// æ”¾ç¼©ç”»å¸ƒ
import * as zoom from "d3-zoom";
// åˆå¹¶åˆ°d3ä¸Š
const d3 = Object.assign({}, forceSimulation, { select }, zoom);
```

ä»¥å‰è¿˜è¯´`requirejs`ä¸èƒ½`tree shaking`ï¼Œç”¨è¿™ç§å†™æ³•ç›´æ¥éƒ½ä¸ç”¨è€ƒè™‘æ‰“åŒ…å·¥å…·äº†ï¼Œå¤©ç”Ÿ`tree shaking`ï¼Œå“ˆå“ˆå“ˆã€‚



ä¸ºäº†èƒ½æ•´ä½“ç¼©æ”¾ï¼Œæ·»åŠ å®¹å™¨åŒ…è£¹ä½æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹ï¼š

```html
<svg class="net-svg">
 <g class="ground">
 	<g class="node"></g>
 	<g class="link"></g>   
 </g>
</svg>
```

å°†å°±çœ‹å§ï¼Œä¸æ”¯æŒ`PUG`æ¨¡æ¿æ ‡ç­¾ã€‚ã€‚

åœ¨`methods`ä¸­ï¼Œæ‰¾åˆ°`resize`æ—¶æ‰§è¡Œçš„`animate`æ–¹æ³•ï¼Œåœ¨ä¸‹é¢æ·»åŠ è‡ªå·±çš„é€»è¾‘ï¼š

```javascript
// vue.methods...
animate() {
    // simulation restart...
    const vm = this;
    function zoomed({ transform }) {
        // ç¼©æ”¾åè®°å½•å½“å‰ç¼©æ”¾ç­‰çº§
        vm.transform = transform;
        // ç¼©æ”¾çš„æ˜¯å®¹å™¨
        d3.select(".ground").attr("transform", transform);
    }
    // é€‰ä¸­svgæ ‡ç­¾ï¼Œæ·»åŠ zoomäº‹ä»¶
    d3.select(".net-svg").call(
        d3.zoom()
        .extent([
            [0, 0],
            [this.size.w, this.size.h],
        ])
        .scaleExtent([1, 8])
        .on("zoom", zoomed)
    );
},
```

æ”¾å¤§åæ•ˆæœï¼ˆå›¾ç‰‡5Mï¼Œè€å¿ƒç­‰å¾…â˜•ï¼‰ï¼š

![1jb8x-khgdq-tuya](ä¸ºåŠ›å¯¼å‘å›¾æ·»åŠ ç¼©æ”¾ç§»åŠ¨ç‰¹æ€§/1jb8x-khgdq-tuya.gif)

è¿™æ—¶å·²ç»å¯ä»¥ç¼©æ”¾äº†ï¼Œä½†æ˜¯é¼ æ ‡ç‚¹å‡»èŠ‚ç‚¹å’Œæ ‡ç­¾æ—¶è¿˜æœ‰åç§»ï¼Œéœ€è¦å°†`transform`åŠ å›æ¥ã€‚

```javascript
// é¼ æ ‡æ‹–åŠ¨èŠ‚ç‚¹äº‹ä»¶å¤„ç†æ–¹æ³•
move(event) {
    if (!this.dragging) return;
    let pos = this.clientPos(event);
    if (this.nodes[this.dragging]) {
        this.simulation.restart();
        this.simulation.alpha(0.5);
        // å°†ç°åœ¨ç¼©æ”¾ç­‰çº§åŠ å›æ¥
        const _trans = this.transform;
        this.nodes[this.dragging].fx = (pos.x - _trans.x) / _trans.k;
        this.nodes[this.dragging].fy = (pos.y - _trans.y) / _trans.k;
    }
},
```

å…³äºç¼©æ”¾åçš„åæ ‡è®¡ç®—ğŸ˜‹ï¼š

![image-20220608113013546](ä¸ºåŠ›å¯¼å‘å›¾æ·»åŠ ç¼©æ”¾ç§»åŠ¨ç‰¹æ€§/image-20220608113013546.png)

ç”±ç‚¹$(x,y)$æ”¾å¤§$a=b$å€åçš„ç‚¹$(X,Y)$æœ‰å¦‚ä¸‹å…³ç³»ï¼š

$$X=ax,Y=by$$

å¦‚ï¼Œç‚¹$(100,100)$ç­‰æ¯”æ”¾å¤§2å€ååº”ä¸º$(200,200)$ï¼Œå³ç‚¹$(x,y)$ä¹˜ä»¥ç¼©æ”¾çŸ©é˜µ

![MommyTalk1654663171956](ä¸ºåŠ›å¯¼å‘å›¾æ·»åŠ ç¼©æ”¾ç§»åŠ¨ç‰¹æ€§/MommyTalk1654663171956.svg)

ä½†æ˜¯ç”±äºæˆ‘ä»¬å±å¹•å¤§å°å›ºå®šï¼Œåˆå› ä¸º`d3`ç»™ç®—å‡ºæ¥äº†è½¬æ¢åçš„åæ ‡åç§»ï¼Œç›´æ¥å¯¹å…¶æ±‚é€†çŸ©é˜µå°±å¥½äº†

![img](ä¸ºåŠ›å¯¼å‘å›¾æ·»åŠ ç¼©æ”¾ç§»åŠ¨ç‰¹æ€§/20170328180120476.png)

æ‰€ä»¥å°±æœ‰äº†ä¸Šé¢çš„ä»£ç ï¼š

```javascript
this.nodes[this.dragging].fx = (pos.x - _trans.x) / _trans.k;
this.nodes[this.dragging].fy = (pos.y - _trans.y) / _trans.k;
```

- pos é¼ æ ‡è·ç¦»è§†å£åæ ‡
- _trans.x,y è½¬æ¢åçš„åŸç‚¹åæ ‡
- _trans.k ç¼©æ”¾ç­‰çº§

ä¸Šé¢å°±æ˜¯å…¨éƒ¨çš„å¯¹æºç çš„æ“ä½œäº†ï¼Œè¿˜æœ‰äº›ç»†èŠ‚æˆ‘æ²¡è´´ï¼Œå°±è¿™æ ·å§ã€‚ã€‚



## æ€»ç»“ğŸ™Œ

d3 çœŸå¥½ç”¨ï¼Œå¥½å°±å¥½åœ¨7ä¸ªç‰ˆæœ¬7ä¸ªå†™æ³•ğŸ˜…

æˆ‘forkå‡ºæ¥çš„é¡¹ç›®åœ°å€ï¼š

[sunzehui/vue-d3-network: Vue component to graph networks using d3-force (github.com)](https://github.com/sunzehui/vue-d3-network)

åŸä»“åº“åœ°å€ï¼š

[emiliorizzo/vue-d3-network: Vue component to graph networks using d3-force (github.com)](https://github.com/emiliorizzo/vue-d3-network)



å‚è€ƒèµ„æ–™ï¼š

[javascript - Get mouse position in SVG co-ordinates after zoom - Stack Overflow](https://stackoverflow.com/questions/50243442/get-mouse-position-in-svg-co-ordinates-after-zoom)

[(92æ¡æ¶ˆæ¯) ã€OpenCV & Pythonã€‘å›¾åƒå‡ ä½•å˜æ¢ï¼šæ—‹è½¬ï¼Œç¼©æ”¾ï¼Œå¹³ç§»_DXduxing1çš„åšå®¢-CSDNåšå®¢_pythonå›¾åƒå‡ ä½•å˜æ¢](https://blog.csdn.net/qq_39507445/article/details/79042477)

[(92æ¡æ¶ˆæ¯) è®¡ç®—æœºå›¾å½¢å­¦ï¼ˆå››ï¼‰å‡ ä½•å˜æ¢_3_çŸ©é˜µé€†å˜æ¢_heyuchang666çš„åšå®¢-CSDNåšå®¢_å¹³ç§»çŸ©é˜µçš„é€†](https://blog.csdn.net/heyuchang666/article/details/67639887)

[æ©Ÿå™¨è¦–è¦ºæŠ€è¡“ - é™³å…µæ—— - Google å›¾ä¹¦](
