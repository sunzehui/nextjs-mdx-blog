---
title: è®¨è®ºå‰ç«¯æ¨¡å—é—´é€šä¿¡5ç§æ–¹å¼
tags:
  - coding
abbrlink: bea61df6
date: 2023-04-06 20:58:08
desc: å‰ç«¯åˆ’åˆ†ç»„ä»¶åï¼Œæƒ³è¦å®ç°ä»£ç è€¦åˆåº¦ä½å¹¶ä¸”äº•ç„¶æœ‰åºï¼Œå°±å¿…é¡»è®¤è¯†å¸¸è§æ¨¡å—é—´é€šä¿¡æ–¹å¼çš„å®ç°åŠå…¶ä¼˜ç¼ºç‚¹ï¼Œå‡†ç¡®æŠŠæ¡åº”ç”¨åœºæ™¯ï¼Œåœ¨å¤æ‚ä¸ç®€å•ä¹‹é—´å¯»æ‰¾å¹³è¡¡ã€‚
---





æ¨èäº†è§£ï¼š[âš”ï¸ Cross micro frontends communication ğŸ“¦ - DEV Community](https://dev.to/luistak/cross-micro-frontends-communication-30m3)

å‰ç«¯æ¨¡å—é—´é€šä¿¡æ–¹å¼å¤§è‡´5ç§ï¼š

- web workers
- props & callbacks
- custom events
- pub/sub library
- ç»“åˆåœºæ™¯è‡ªè¡Œå®ç°é€šä¿¡

å…¶ä¸­web workersæˆ‘ä¸ç»å¸¸ä½¿ç”¨ï¼Œåé¢4ä¸ªçš†æœ‰åœ¨æœ€è¿‘åšçš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°ï¼Œç®€å•è®²è®²ç”¨åˆ°çš„åœºæ™¯ä»¥åŠä½¿ç”¨æ„Ÿå—ã€‚

## å‰ç«¯æ¨¡å—é—´é€šä¿¡æ–¹å¼

### props & callback

æ¯”å¦‚çˆ¶é¡µé¢å¼¹å‡ºiframeå­çª—å£

çˆ¶ä¼ å­ï¼šçˆ¶é¡µé¢æ‰“å¼€å­çª—å£ä¹‹å‰å¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå­çª—å£åŠ è½½æ—¶å»è¯»å…¨å±€å˜é‡ï¼Œæ­¤æ—¶å°±æ˜¯æœ€æ–°çš„æ•°æ®

å­ä¼ çˆ¶ï¼šå­çª—å£å¯ä»¥è°ƒç”¨çˆ¶é¡µé¢çš„å…¨å±€å‡½æ•°ï¼Œå°†è‡ªå·±å†…éƒ¨çš„æ•°æ®ä¼ å›çˆ¶é¡µé¢ã€‚

```javascript
// index.html çˆ¶é¡µé¢
window.props = {
    message: 'hello'
}
window.setProps = val => Object.assign({}, window.props, val)
layer.open('./dialog.html');

// dialog.html å­çª—å£
console.log(parent.props) // hello
parent.setProps({
    message: 'world'
})
```

ä¼˜ç‚¹ï¼šè¿™ç§æ–¹å¼æœ€ç›´æ¥ï¼Œæœ€å®¹æ˜“æ¥å—ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„æ‰‹æ®µã€‚

ç¼ºç‚¹ï¼šæ²¡æœ‰å·¥ç¨‹åŒ–æ¡†æ¶æ—¶ï¼ˆå¦‚Vue, React...ï¼‰åªèƒ½ä¾èµ–å…¨å±€å˜é‡å…±äº«ï¼Œå…¨å±€å˜é‡æœ¬èº«å¸¦æœ‰å±€é™æ€§ã€‚



### custom event

jsåŸç”Ÿæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶æœºå‘å¸ƒè‡ªå·±çš„äº‹ä»¶å¹¶æºå¸¦æ•°æ®ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨å…¶è¿›è¡Œé€šä¿¡ã€‚

çˆ¶é¡µé¢ï¼šåŠ è½½APIæ•°æ®åˆ°è¾¾ï¼Œå‘å…¨å±€å‘é€'data-loaded'äº‹ä»¶ã€‚

ä¾èµ–APIæ•°æ®çš„é¡µé¢ï¼šç›‘å¬â€˜data-loadedâ€™ï¼Œå¯¹æ•°æ®å¤„ç†ã€‚

```javascript
// main.js
request().then(result => {
    const customEvent = new CustomEvent('data-loaded', { result });
    window.dispatchEvent(customEvent)
});
// card.js
window.addEvevntListener('data-loaded', result => {
    result.map( /* do something... */)
})
```

ä¼˜ç‚¹ï¼šä¸ä¾èµ–å…¨å±€å˜é‡ï¼Œä¸é™äºæ¡†æ¶/åŸç”Ÿï¼Œå› ä¸ºè‡ªå®šä¹‰äº‹ä»¶åŸç”Ÿæ”¯æŒ

ç¼ºç‚¹ï¼šå¦‚æœç›‘å¬äº‹ä»¶æ¯”è§¦å‘äº‹ä»¶æ™šäº†ï¼ˆè§¦å‘äº‹ä»¶æ—¶è¿˜æ²¡æ¥å¾—åŠç›‘å¬ï¼‰ï¼Œä¼šå¯¼è‡´æ”¶ä¸åˆ°äº‹ä»¶ï¼›ç¼–ç éš¾åº¦è¾ƒé«˜ï¼Œéœ€è¦æœ‰ä»£ç è®¾è®¡èƒ½åŠ›ã€‚



### pub/sub library

ä¾é åŸºäºpub/subæ¨¡å¼çš„ä»£ç åº“å¯ä»¥è½»æ¾å®ç°é¡µé¢é—´é€šä¿¡ï¼Œç”¨çš„æ¯”è¾ƒé¡ºæ‰‹çš„rxjsè¶³å¤Ÿåº”ä»˜å¤§å¤šæ•°åœºæ™¯ï¼Œæœ€è¿‘ä¹Ÿç”¨åˆ°äº†å…¶ä¸­çš„subjectã€‚

çˆ¶é¡µé¢ï¼šåˆ›å»ºå¯è§‚å¯Ÿå¯¹è±¡ï¼Œç®¡ç†æ•°æ®å¢åˆ æ”¹æŸ¥ï¼Œè€Œä¸å…³å¿ƒè§†å›¾ç»“æ„ã€‚

å­é¡µé¢ï¼šè®¢é˜…å¯è§‚å¯Ÿå¯¹è±¡ï¼Œä¾æ®çˆ¶é¡µé¢æ•°æ®æ¸²æŸ“é¡µé¢ã€‚

```javascript
// main.js
window.subject = new rxjs.BehaviorSubject([]);
request().then(result => window.subject.next(result))

// card.js
window.subject.subscribe(
	val => render(val)
)
```

ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œä»£ç è½»é‡ï¼›rxjsæœ¬èº«å¾ˆå¼ºå¤§ï¼Œå¯å¤„ç†å¤æ‚åœºæ™¯ï¼›

ç¼ºç‚¹ï¼šä¾èµ–rxjså¢åŠ é¡µé¢è´Ÿæ‹…ï¼›åŒè‡ªå®šä¹‰äº‹ä»¶ç±»ä¼¼



## è§¦å‘äº‹ä»¶æ™šäºç›‘å¬äº‹ä»¶è§£å†³åŠæ³•

åœ¨RxJSä¸­ï¼Œå¯ä»¥ä½¿ç”¨Subjectæ¥å®ç°ç›‘å¬è€…å’Œç›‘å¬çš„åŠŸèƒ½ã€‚å¦‚æœè¦ç›‘å¬ç›‘å¬è€…è§¦å‘ç›‘å¬ä¹‹å‰çš„æ›´æ–°ï¼Œå¯ä»¥å°†ç›‘å¬è€…çš„æ›´æ–°å…ˆå­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç„¶ååœ¨Subjectè¿›è¡Œè®¢é˜…æ—¶ï¼Œå…ˆå°†å­˜æ”¾çš„æ›´æ–°å‘é€å‡ºå»ï¼Œå†å°†Subjectæœ¬èº«åŠ å…¥åˆ°ç›‘å¬è€…ä¸­ï¼Œä»¥ä¾¿åç»­çš„æ›´æ–°å¯ä»¥è¢«Subjectç›‘å¬åˆ°ã€‚

```typescript
import { Subject } from 'rxjs';

class Listener {
  private updates: any[] = [];
  private subject = new Subject();

  addUpdate(update: any) {
    this.updates.push(update);
  }

  listen() {
    // å‘é€ä¹‹å‰çš„æ›´æ–°
    this.updates.forEach((update) => this.subject.next(update));

    // åŠ å…¥Subjectè¿›è¡Œåç»­çš„ç›‘å¬
    this.subject.subscribe((update) => console.log('update:', update));
  }

  update(update: any) {
    this.addUpdate(update);
    // è§¦å‘ç›‘å¬
    this.listen();
  }
}

const listener = new Listener();

// æ›´æ–°ä¹‹å‰ï¼Œå…ˆç›‘å¬
listener.listen();

// æ›´æ–°
listener.update('update 1');

// å†æ¬¡ç›‘å¬
listener.listen();

// æ›´æ–°
listener.update('update 2');
```

ä»¥ä¸Šä»£ç æ¥æºï¼šChatGPT 3.5





ä½†æ˜¯ç›´æ¥ä½¿ç”¨`ReplaySubject`å³å¯è§£å†³é—®é¢˜ï¼Œè¿™æ˜¯`ReplaySubject`çš„æè¿°ï¼š

![img](è®¨è®ºå‰ç«¯æ¨¡å—é—´é€šä¿¡5ç§æ–¹å¼/ReplaySubject.png)

> **ReplaySubject** å°†å¯¹è§‚å¯Ÿè€…å‘é€å…¨éƒ¨çš„å…ƒç´ ï¼Œæ— è®ºè§‚å¯Ÿè€…æ˜¯ä½•æ—¶è¿›è¡Œè®¢é˜…çš„ã€‚
>
> è¿™é‡Œå­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„ **ReplaySubject**ï¼Œæœ‰çš„åªä¼šå°†æœ€æ–°çš„ n ä¸ªå…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ï¼Œæœ‰çš„åªä¼šå°†é™åˆ¶æ—¶é—´æ®µå†…æœ€æ–°çš„å…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ã€‚  â€”â€”[ReplaySubject Â· RxSwift ä¸­æ–‡æ–‡æ¡£ (beeth0ven.github.io)](https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer/replay_subject.html)

